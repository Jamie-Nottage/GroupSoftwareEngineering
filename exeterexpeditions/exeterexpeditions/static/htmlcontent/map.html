<button id="hint3">HINT 3: Location on the map (-10)</button>
<button id="hint">HINT: Find current location (-5)</button>
<button id="checkIn">Check In</button>
<button id="distance">Calculate Distance</button>
	<div id="map"></div>
	<script>
	var mysql = require('mysql');

	var con = mysql.createConnection({
		host: "exeter-expedition-db.mysql.database.azure.com",
		user: "groupo@exeter-exepdition-db",
		password: "MatthewYates2000",
		database: "GAME_DATABASE"
	});

	con.connect(function(err) {
		if (err) throw err;
		con.query("SELECT * FROM Route WHERE pathId = 1",function(err,result,fields){
			if (err) throw err;
			console.log(result);
		});
	});



	function initMap() {

			var exeterMap = new google.maps.StyledMapType(
		[
			{
			"elementType": "labels",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "administrative",
			"elementType": "geometry",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "administrative.land_parcel",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "administrative.neighborhood",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "poi",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "poi.school",
			"elementType": "geometry.fill",
			"stylers": [
				{
				"color": "#48c77d"
				},
				{
				"visibility": "on"
				}
			]
			},
			{
			"featureType": "poi.school",
			"elementType": "geometry.stroke",
			"stylers": [
				{
				"color": "#3fabfc"
				},
				{
				"visibility": "on"
				}
			]
			},
			{
			"featureType": "poi.school",
			"elementType": "labels.icon",
			"stylers": [
				{
				"color": "#0080ff"
				},
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "poi.school",
			"elementType": "labels.text",
			"stylers": [
				{
				"color": "#bfd7ea"
				}
			]
			},
			{
			"featureType": "poi.school",
			"elementType": "labels.text.fill",
			"stylers": [
				{
				"color": "#bfd7ea"
				}
			]
			},
			{
			"featureType": "poi.school",
			"elementType": "labels.text.stroke",
			"stylers": [
				{
				"color": "#000000"
				},
				{
				"weight": 5
				}
			]
			},
			{
			"featureType": "road",
			"elementType": "geometry.fill",
			"stylers": [
				{
				"color": "#bfd7ea"
				},
				{
				"weight": 2.5
				}
			]
			},
			{
			"featureType": "road",
			"elementType": "geometry.stroke",
			"stylers": [
				{
				"color": "#000000"
				},
				{
				"weight": 0.5
				}
			]
			},
			{
			"featureType": "road",
			"elementType": "labels",
			"stylers": [
				{
				"color": "#bfd7ea"
				}
			]
			},
			{
			"featureType": "road",
			"elementType": "labels.icon",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			},
			{
			"featureType": "road",
			"elementType": "labels.text",
			"stylers": [
				{
				"color": "#bfd7ea"
				},
				{
				"visibility": "on"
				},
				{
				"weight": 0.5
				}
			]
			},
			{
			"featureType": "road",
			"elementType": "labels.text.stroke",
			"stylers": [
				{
				"color": "#4b4b4b"
				},
				{
				"weight": 2.0
				}
			]
			},
			{
			"featureType": "road.local",
			"elementType": "geometry.fill",
			"stylers": [
				{
				"visibility": "on"
				}
			]
			},
			{
			"featureType": "transit",
			"stylers": [
				{
				"visibility": "off"
				}
			]
			}
		],
			{name: 'Styled Map'});

	var university = {lat:50.736137,lng:-3.534947}
	var innovation = {lat: 50.738506, lng: -3.531004}
	var harrison = {lat:50.737739,lng:-3.532628}
	var streathamCourt = {lat:50.73567,lng:-3.530897}
	var devonshireHouse ={lat:50.735167,lng:-3.534269}
	var queens = {lat:50.734044,lng:-3.535082}
	var forum = {lat:50.735459,lng:-3.533207}
	var newman = {lat:50.736491,lng:-3.535967}
	var innoMarker
	var harrMarker
	var streathamMarker
	var devonshireMarker
	var queensMarker
	var forumMarker
	var newmanMarker
	var buildingMarkers = [innoMarker,harrMarker,streathamMarker,devonshireMarker,queensMarker,forumMarker,newmanMarker]
	var buildings = [ innovation, harrison, streathamCourt,devonshireHouse,queens,forum,newman]
	var building = [ "innovation", "harrison", "streathamCourt","devonshireHouse","queens","forum","newman"]
	var markerImg = 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
	var infoImg = 'https://img.icons8.com/officexs/2x/info.png'
	var userImg = 'static/img/dora.png'
	var minZoomLevel = 16;
	var infoWindow;
	var hintWindow;
	var pos;
			var map = new google.maps.Map(document.getElementById('map'), {
		center: university,
		zoom: minZoomLevel,
		minZoom: minZoomLevel,
		style:exeterMap,
		disableDefaultUI: true,
		zoomControl: true,
		zoomControlOptions: {
			position: google.maps.ControlPosition.LEFT_CENTER
		}
	});
	map.mapTypes.set('styled_map', exeterMap);
	map.setMapTypeId('styled_map');

	infoWindow = new google.maps.InfoWindow;
	hintWindow = new google.maps.InfoWindow;

	var InnoDesc = '<div id="content">'+
		'<div id="siteNotice">'+
		'</div>'+
		'<h1 id="firstHeading" class="firstHeading">Innovation Centre </h1>'+
		'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
		'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
		'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'
	var innovationInfo = new google.maps.InfoWindow({
		content: InnoDesc
	});

	var harrisonDesc = '<div id="content">'+
		'<div id="siteNotice">'+
		'</div>'+
		'<h1 id="firstHeading" class="firstHeading">Harrison</h1>' +
		'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
		'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
		'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'

	var harrisonInfo = new google.maps.InfoWindow({
		content: harrisonDesc
	});

	var queensDesc = '<div id="content">'+
		'<div id="siteNotice">'+
	'</div>'+
	'<h1 id="firstHeading" class="firstHeading">Queens</h1>' +
	'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
	'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
	'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'

	var queensInfo = new google.maps.InfoWindow({
		content: queensDesc
	});

	var forumDesc = '<div id="content">'+
		'<div id="siteNotice">'+
		'</div>'+
		'<h1 id="firstHeading" class="firstHeading">Forum</h1>' +
		'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
		'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
		'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'

	var forumInfo = new google.maps.InfoWindow({
		content: forumDesc
	});

	var devonshireDesc = '<div id="content">'+
		'<div id="siteNotice">'+
		'</div>'+
		'<h1 id="firstHeading" class="firstHeading">Devonshire House</h1>' +
		'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
		'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
		'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'

	var devonshireInfo = new google.maps.InfoWindow({
		content: devonshireDesc
	});

	var streathamDesc = '<div id="content">'+
		'<div id="siteNotice">'+
		'</div>'+
		'<h1 id="firstHeading" class="firstHeading">Streatham Court</h1>'+
		'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
		'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
		'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'

	 var streathamInfo = new google.maps.InfoWindow({
		content: streathamDesc
	});

	var newmanDesc = '<div id="content">'+
		'<div id="siteNotice">'+
		'</div>'+
		'<h1 id="firstHeading" class="firstHeading">Newman</h1>' +
		'<p>(You earned 50 points)</p> <div id= "bodyContent">' +
		'<p><b>Extra Tasks:</b> </p> <p> 1.????????? - 5pts </p>' +
		'<p> 2.????????? - 5pts </p> <p> 3.????????? - 5pts</p>'

	var newmanInfo = new google.maps.InfoWindow({
		content: newmanDesc
	});

	var info = [innovationInfo, harrisonInfo, streathamInfo,devonshireInfo,queensInfo,forumInfo,newmanInfo]

	// bounds of the desired area
	//var allowedBounds = new google.maps.LatLngBounds(
	//	new google.maps.LatLng(49.965784, -1.535464),
	//	new google.maps.LatLng(51.440728, -5.512514)
	//);
	//var lastValidCenter = map.getCenter();

//	google.maps.event.addListener(map, 'center_changed', function() {
//	if (allowedBounds.contains(map.getCenter())) {
//			// still within valid bounds, so save the last valid position
//			lastValidCenter = map.getCenter();
//	return;
	//}

	// not valid anymore => return to last valid position
	//map.panTo(lastValidCenter);
//});


	function findFresher(){
		if (navigator.geolocation) {
			navigator.geolocation.watchPosition(function(position) {
			pos = {
			lat: position.coords.latitude,
			lng: position.coords.longitude
			};

			var fresherLocation = new google.maps.Marker({
				map: map,
				draggable: false,
				icon: userImg,
				position: pos
			});

			map.setCenter(pos);
			}, function() {
			handleLocationError(true, infoWindow, map.getCenter());
			},{
			enableHighAccuracy: true,
			timeout: 5000,
			maximumAge: 0});
		} else {
			handleLocationError(false, infoWindow, map.getCenter());
		}
	}


	function handleLocationError(browserHasGeolocation, infoWindow, pos) {
		infoWindow.setPosition(pos);
		infoWindow.setContent(browserHasGeolocation ?
							'Error: The Geolocation service failed.' :
							'Error: Your browser doesn\'t support geolocation.');
		infoWindow.open(map);
	}

	function calculateDistance(){
		findFresher();
		var distance = new google.maps.DistanceMatrixService();
		distance.getDistanceMatrix(
			{
				origins: [building.getPosition()],
				destinations: [building.getPosition()]
			}, callback);
	}

	function callback(response,status){
		if (status == 'OK') {
			var origins = response.originAddresses;
			var destinations = response.destinationAddresses;
			var distance = response.rows[0].elements[0].distance;
		}
	}

	function handleNearLocation(intWindow, pos) {
		hintWindow.setPosition(pos);
		hintWindow.setContent('YOURE NEAR A LOCATION!');
		hintWindow.open(map);
	}

	function foundBuilding(){
		var i = buildingMarkers.length - buildings.length - 1
		buildingMarkers[i].setIcon(infoImg);
	}



	function addMarker(){
		var i = buildingMarkers.length - buildings.length
		var prevMarker = buildingMarkers[i - 1]

		if(i==0){
			buildingMarkers[i] = new google.maps.Marker({
			map: map,
			draggable: false,
			icon: markerImg,
			animation: google.maps.Animation.DROP,
			position: buildings[0]
			});
			var addListener = function(i){
				google.maps.event.addListener(buildingMarkers[0],'click',function(){
					info[0].open(map,buildingMarkers[0]);
				});
			}
			buildings.shift();
			addListener(0);

		}

		else if(prevMarker.getPosition() == building[building.length-1]){
			handleFinishedError(hintWindow, map.getCenter());
			window.alert('Youve found all the locations of our map! Congrats!');

		}
		else if(prevMarker.getIcon() == infoImg){
			buildingMarkers[i] = new google.maps.Marker({
				map: map,
				draggable: false,
				icon: markerImg,
				animation: google.maps.Animation.DROP,
				position: buildings[0]
				});
				var addListener = function(i){
					google.maps.event.addListener(buildingMarkers[i],'click',function(){
						info[i].open(map,buildingMarkers[i]);
					});
				}
				buildings.shift();
				addListener(i);
		}
		else {
			handleDisplayError(hintWindow, prevMarker.getPosition());
			window.alert('The location of your next building is already displayed');
			}
	}

	function handleDisplayError(intWindow, pos) {
		hintWindow.setPosition(pos);
		hintWindow.setContent('The location of your next building is already displayed');
		hintWindow.open(map);
	}

	function handleFinishedError(intWindow, pos) {
		hintWindow.setPosition(pos);
		hintWindow.setContent('Youve found all the locations of our map! Congrats!');
		hintWindow.open(map);
	}


	google.maps.event.addListener(map, 'zoom_changed', function() {
		if (map.getZoom() < minZoomLevel) map.setZoom(minZoomLevel);
	});
	google.maps.event.addDomListener(document.getElementById('hint3'),'click',addMarker);
	google.maps.event.addDomListener(document.getElementById('hint'),'click',findFresher);
	google.maps.event.addDomListener(document.getElementById('checkIn'),'click',foundBuilding);
	google.maps.event.addDomListener(document.getElementById('distance'),'click',calculateDistance);
	}
	</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAR63gcZxCokH-0tp8YGK8ztlucu4epRzs&callback=initMap">
	</script>
